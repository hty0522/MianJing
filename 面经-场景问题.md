# 场景问题

### 如何解决多用户并发访问秒杀商品的请求问题和数据存储问题？

#### 秒杀业务优化

​		拦截请求，只放一部分请求进来，不要让锁冲突落到数据库上去。以100W人抢10个手机为例，随机只放1000个请求进来就好。可以利用消息队列的方式，每秒放一批进来。没成功的就返回失败，不要让压力转移到服务器端。

​		充分利用缓存，先把数据库里的东西提前加载到redis来；其次由于redis串行执行，可以在redis中存储一个信息，每一个请求进来，key值减1，等减到0的时候，拒绝所有请求。防止超卖



### 为什么要用消息队列

1. 通过异步处理提高系统性能（削峰、减少响应所需时间）
2. 降低系统耦合性

### 如何时间排行榜

在数据量比较小的时候直接用mysql

加索引，限制排序的数量，比如只排序前100名

redis有一个zset数据结构，可以利用redis的zset数据结构进行排序



### 分布式锁的场景和可能出现的问题以及解决方案

防止库存超卖，将数据提前加载到redis当中，某一时刻只能有一个请求获取这个锁，所有请求串行化处理，只有获得锁的请求才能继续执行下面的操作，但是这样在高并发下，成千上万个请求获取一个锁，处理效率过慢，处理那种低并发的可能还好，可能的解决方案是两种，redis集群，1000部手机，20个redis服务器，每台服务器可以有一个50的value值，各自扣自己的，或者采用分段加锁的机制，每20个算一段，本段加锁后尝试获取下一段的锁，知道获得锁或者全部锁都被占用，两种方法是一个思路，都是将这个value值分散开，使得某一时刻可以有N个请求执行操作，提高并发能力。



### redis大key问题

**最典型的就是阻塞线程，并发量下降，导致客户端超时，服务端业务成功率下降**。

如果发现某些大key并非热key就可以在DB中查询使用，则可以在Redis中删掉：
